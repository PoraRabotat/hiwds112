<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - MarketPlace</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <span>üõçÔ∏è</span>
                MarketPlace
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="login.html" class="nav-link">–í—Ö–æ–¥</a>
                <a href="register.html" class="nav-link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
        </nav>
    </header>

    <main class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1 class="auth-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                <p class="auth-subtitle">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç</p>
            </div>

            <div id="message-container"></div>

            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label" for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" id="username" name="username" required 
                           oninput="checkUsername(this.value)">
                    <div id="username-feedback" style="font-size: 0.8rem; margin-top: 0.25rem;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="full_name">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                    <input type="text" class="form-input" id="full_name" name="full_name" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="role">–†–æ–ª—å</label>
                    <select class="form-select" id="role" name="role" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                        <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
                        <option value="seller">–ü—Ä–æ–¥–∞–≤–µ—Ü</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-container">
                        <input type="password" class="form-input" id="password" name="password" required 
                               oninput="checkPassword(this.value)">
                        <button type="button" class="password-toggle" onclick="togglePassword('password')">
                            üëÅÔ∏è
                        </button>
                    </div>
                    <div id="password-strength" style="font-size: 0.8rem; margin-top: 0.25rem;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirm_password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-container">
                        <input type="password" class="form-input" id="confirm_password" name="confirm_password" required
                               oninput="checkPasswordMatch()">
                        <button type="button" class="password-toggle" onclick="togglePassword('confirm_password')">
                            üëÅÔ∏è
                        </button>
                    </div>
                    <div id="password-match" style="font-size: 0.8rem; margin-top: 0.25rem;"></div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
            </form>

            <div class="form-footer" style="text-align: center; margin-top: 1.5rem;">
                <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="login.html" style="color: var(--primary);">–í–æ–π–¥–∏—Ç–µ</a></p>
            </div>
        </div>
    </main>

    <script>
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function checkUsername(username) {
            const feedback = document.getElementById('username-feedback');
            if (username.length < 3) {
                feedback.textContent = '‚ùå –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                feedback.style.color = 'var(--error)';
            } else if (username.length > 20) {
                feedback.textContent = '‚ùå –ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤';
                feedback.style.color = 'var(--error)';
            } else {
                feedback.textContent = '‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ';
                feedback.style.color = 'var(--success)';
            }
        }

        function checkPassword(password) {
            const feedback = document.getElementById('password-strength');
            let strength = 0;
            
            if (password.length >= 6) strength += 25;
            if (/[a-z]/.test(password)) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/\d/.test(password)) strength += 25;
            
            if (strength <= 25) {
                feedback.textContent = '‚ùå –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å';
                feedback.style.color = 'var(--error)';
            } else if (strength <= 50) {
                feedback.textContent = '‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–æ–ª—å';
                feedback.style.color = 'var(--warning)';
            } else if (strength <= 75) {
                feedback.textContent = '‚úÖ –•–æ—Ä–æ—à–∏–π –ø–∞—Ä–æ–ª—å';
                feedback.style.color = 'var(--success)';
            } else {
                feedback.textContent = '‚úÖ –û—Ç–ª–∏—á–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                feedback.style.color = 'var(--success)';
            }
        }

        function checkPasswordMatch() {
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirm_password').value;
            const feedback = document.getElementById('password-match');
            
            if (confirm && password !== confirm) {
                feedback.textContent = '‚ùå –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                feedback.style.color = 'var(--error)';
            } else if (confirm) {
                feedback.textContent = '‚úÖ –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                feedback.style.color = 'var(--success)';
            } else {
                feedback.textContent = '';
            }
        }

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('auth.php?action=register', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        function showMessage(message, type) {
            const container = document.getElementById('message-container');
            container.innerHTML = `<div class="message ${type}">${message}</div>`;
        }
    </script>
</body>
</html>