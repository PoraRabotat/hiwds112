<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - MarketPlace</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <span>üõçÔ∏è</span>
                MarketPlace
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="profile.html" class="nav-link">–ü—Ä–æ—Ñ–∏–ª—å</a>
                <a href="purchases.html" class="nav-link">–ü–æ–∫—É–ø–∫–∏</a>
                <div id="adminLink" style="display: none;">
                    <a href="admin.html" class="nav-link">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                </div>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                    <span id="userRole" class="role-badge role-client">–ö–ª–∏–µ–Ω—Ç</span>
                </div>
                <a href="logout.php" class="btn btn-logout">–í—ã–π—Ç–∏</a>
            </div>
        </nav>
    </header>

    <main class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <h1 class="dashboard-title" id="welcomeTitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
                <p class="dashboard-subtitle" id="welcomeSubtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPurchases">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–∫—É–ø–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSpent">0 ‚ÇΩ</div>
                    <div class="stat-label">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="accountAge">0 –¥–Ω.</div>
                    <div class="stat-label">–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω</div>
                </div>
            </div>

            <div class="profile-section">
                <h2 class="section-title">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <a href="profile.html" class="btn btn-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                    <a href="purchases.html" class="btn btn-primary">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</a>
                    <div id="sellerActions" style="display: none;">
                        <a href="products.html" class="btn btn-primary">–ú–æ–∏ —Ç–æ–≤–∞—Ä—ã</a>
                    </div>
                </div>
            </div>

            <div class="profile-section">
                <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</h2>
                <div id="recentPurchases">
                    <!-- –ü–æ–∫—É–ø–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            try {
                const response = await fetch('user.php?action=get_data');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('userName').textContent = data.user.username;
                    document.getElementById('welcomeTitle').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${data.user.full_name}!`;
                    
                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–∏
                    const roleElement = document.getElementById('userRole');
                    roleElement.textContent = data.user.role;
                    roleElement.className = `role-badge role-${data.user.role}`;
                    
                    // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
                    if (data.user.role === 'admin') {
                        document.getElementById('adminLink').style.display = 'block';
                    }
                    
                    // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–æ–¥–∞–≤—Ü–∞
                    if (data.user.role === 'seller' || data.user.role === 'admin') {
                        document.getElementById('sellerActions').style.display = 'block';
                    }
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    document.getElementById('totalPurchases').textContent = data.stats.total_purchases;
                    document.getElementById('totalSpent').textContent = data.stats.total_spent + ' ‚ÇΩ';
                    document.getElementById('accountAge').textContent = data.stats.account_age + ' –¥–Ω.';
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫—É–ø–æ–∫
                    loadRecentPurchases();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        async function loadRecentPurchases() {
            try {
                const response = await fetch('purchases.php?action=get_recent');
                const data = await response.json();
                
                const container = document.getElementById('recentPurchases');
                
                if (data.success && data.purchases.length > 0) {
                    container.innerHTML = data.purchases.map(purchase => `
                        <div class="purchase-item">
                            <div style="font-size: 2rem;">üì¶</div>
                            <div class="purchase-info">
                                <div class="purchase-title">${purchase.product_name}</div>
                                <div class="purchase-date">${purchase.purchase_date}</div>
                            </div>
                            <div class="purchase-price">${purchase.price} ‚ÇΩ</div>
                            <span class="status-badge status-${purchase.status}">${getStatusText(purchase.status)}</span>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="text-align: center; color: var(--gray-500);">–ü–æ–∫—É–ø–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫—É–ø–æ–∫:', error);
            }
        }

        function getStatusText(status) {
            const statuses = {
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                'pending': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω–æ'
            };
            return statuses[status] || status;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadUserData);
    </script>
</body>
</html>